// ============================
// Config (links fornecidos)
// ============================
const WHATSAPP_LINK = "https://wa.me/5555999920494";

// HERO / EXPERT (link exato fornecido)
const expertHero = "https://imgur.com/2f5bIag";

// RESULTADOS (o usuário mandou 1 link nesta versão)
// Obs: a galeria já está pronta pra você adicionar mais links depois.
const resultsImages = [
  { src: "https://imgur.com/lCvzAoH", caption: "Resultado real" },
  // Adicione mais aqui:
  // { src: "https://...", caption: "Antes / Depois" },
];

// MAIS PROVAS (bastidores)
// Você disse “as que foram fornecidas”, mas nessa versão só veio a foto hero.
// Então eu já deixei o carrossel funcionando com o hero + placeholders fáceis de trocar.
const expertPhotos = [
  { src: expertHero, label: "Atendimento personalizado" },
  { src: expertHero, label: "Acompanhamento de verdade" },
  { src: expertHero, label: "Treino com direção" },
  // Troque por outras fotos do Lucas quando você tiver:
  // { src: "https://...", label: "Bastidores" },
];

// ============================
// Helpers
// ============================
function $(sel) { return document.querySelector(sel); }

function createGalleryItem({ src, caption }) {
  const btn = document.createElement("button");
  btn.className = "gItem";
  btn.type = "button";

  const img = document.createElement("img");
  img.src = src; // link exato
  img.alt = caption || "Resultado";
  img.loading = "lazy";
  img.decoding = "async";
  img.onerror = () => {
    // Se o link for de página (imgur.com/...), alguns browsers podem não renderizar imagem.
    // Mantém o card sem quebrar o layout.
    img.style.display = "none";
    btn.style.minHeight = "140px";
    btn.style.background =
      "linear-gradient(135deg, rgba(124,92,255,.16), rgba(25,211,255,.10))";
  };

  const cap = document.createElement("span");
  cap.className = "gCap";
  cap.textContent = "Toque para ampliar";

  btn.appendChild(img);
  btn.appendChild(cap);

  btn.addEventListener("click", () => openLightbox(src, caption));
  return btn;
}

// ============================
// Lightbox
// ============================
const lightbox = $("#lightbox");
const lightboxImg = $("#lightboxImg");
const lightboxCaption = $("#lightboxCaption");

function openLightbox(src, caption) {
  lightboxImg.src = src;
  lightboxCaption.textContent = caption || "";
  lightbox.classList.add("is-open");
  lightbox.setAttribute("aria-hidden", "false");
  document.body.style.overflow = "hidden";
}

function closeLightbox() {
  lightbox.classList.remove("is-open");
  lightbox.setAttribute("aria-hidden", "true");
  lightboxImg.src = "";
  lightboxCaption.textContent = "";
  document.body.style.overflow = "";
}

lightbox.addEventListener("click", (e) => {
  if (e.target && e.target.dataset && e.target.dataset.close !== undefined) {
    closeLightbox();
  }
});

document.addEventListener("keydown", (e) => {
  if (e.key === "Escape" && lightbox.classList.contains("is-open")) closeLightbox();
});

// ============================
// Render Resultados
// ============================
const resultsGallery = $("#resultsGallery");

function renderResults() {
  resultsGallery.innerHTML = "";
  resultsImages.forEach((item) => resultsGallery.appendChild(createGalleryItem(item)));

  // Se quiser deixar “espaços” visuais prontos pra adicionar mais links,
  // você pode aumentar esse número.
  const placeholders = Math.max(0, 8 - resultsImages.length);
  for (let i = 0; i < placeholders; i++) {
    const ph = document.createElement("div");
    ph.className = "gItem";
    ph.style.minHeight = "140px";
    ph.style.background = "rgba(234,240,255,.03)";
    ph.style.borderStyle = "dashed";
    ph.style.cursor = "default";
    ph.setAttribute("aria-hidden", "true");
    resultsGallery.appendChild(ph);
  }
}
renderResults();

// ============================
// Carousel (Mais Provas)
// ============================
const track = $("#expertTrack");
const prevBtn = $("#prevExpert");
const nextBtn = $("#nextExpert");

let currentIndex = 0;

function renderCarousel() {
  track.innerHTML = "";
  expertPhotos.forEach((p) => {
    const slide = document.createElement("div");
    slide.className = "slide";

    const img = document.createElement("img");
    img.src = p.src; // link exato
    img.alt = p.label || "Foto do expert";
    img.loading = "lazy";
    img.decoding = "async";
    img.onerror = () => {
      img.style.display = "none";
      slide.style.height = "260px";
      slide.style.background =
        "linear-gradient(135deg, rgba(124,92,255,.16), rgba(25,211,255,.10))";
    };

    const label = document.createElement("span");
    label.className = "label";
    label.textContent = p.label || "";

    slide.appendChild(img);
    slide.appendChild(label);
    track.appendChild(slide);
  });

  updateCarousel();
}

function updateCarousel() {
  track.style.transform = `translateX(-${currentIndex * 100}%)`;
  prevBtn.disabled = currentIndex === 0;
  nextBtn.disabled = currentIndex === expertPhotos.length - 1;
}

prevBtn.addEventListener("click", () => {
  currentIndex = Math.max(0, currentIndex - 1);
  updateCarousel();
});

nextBtn.addEventListener("click", () => {
  currentIndex = Math.min(expertPhotos.length - 1, currentIndex + 1);
  updateCarousel();
});

// Swipe no mobile
let startX = 0;
let isDown = false;

track.addEventListener("pointerdown", (e) => {
  isDown = true;
  startX = e.clientX;
});

track.addEventListener("pointerup", (e) => {
  if (!isDown) return;
  const dx = e.clientX - startX;
  const threshold = 40;

  if (dx > threshold) currentIndex = Math.max(0, currentIndex - 1);
  if (dx < -threshold) currentIndex = Math.min(expertPhotos.length - 1, currentIndex + 1);

  updateCarousel();
  isDown = false;
});

track.addEventListener("pointercancel", () => (isDown = false));
track.addEventListener("pointerleave", () => (isDown = false));

renderCarousel();

// ============================
// (Opcional) UTM / Mensagem pré-preenchida no WhatsApp
// Se quiser, você pode trocar todos os links do WhatsApp por um texto pronto.
// ============================
// const prefill = encodeURIComponent("Oi Lucas! Quero agendar minha primeira avaliação gratuita.");
// document.querySelectorAll(`a[href="${WHATSAPP_LINK}"]`).forEach(a => {
//   a.href = `${WHATSAPP_LINK}?text=${prefill}`;
// });
